<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>src/clipsrules/core/drive.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>src/clipsrules/core/drive.c</h1><a href="drive_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001    <span class="comment">/*******************************************************/</span>
<a name="l00002"></a>00002    <span class="comment">/*      "C" Language Integrated Production System      */</span>
<a name="l00003"></a>00003    <span class="comment">/*                                                     */</span>
<a name="l00004"></a>00004    <span class="comment">/*             CLIPS Version 6.30  10/19/06            */</span>
<a name="l00005"></a>00005    <span class="comment">/*                                                     */</span>
<a name="l00006"></a>00006    <span class="comment">/*                    DRIVE MODULE                     */</span>
<a name="l00007"></a>00007    <span class="comment">/*******************************************************/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/*************************************************************/</span>
<a name="l00010"></a>00010 <span class="comment">/* Purpose: Handles join network activity associated with    */</span>
<a name="l00011"></a>00011 <span class="comment">/*   with the addition of a data entity such as a fact or    */</span>
<a name="l00012"></a>00012 <span class="comment">/*   instance.                                               */</span>
<a name="l00013"></a>00013 <span class="comment">/*                                                           */</span>
<a name="l00014"></a>00014 <span class="comment">/* Principal Programmer(s):                                  */</span>
<a name="l00015"></a>00015 <span class="comment">/*      Gary D. Riley                                        */</span>
<a name="l00016"></a>00016 <span class="comment">/*                                                           */</span>
<a name="l00017"></a>00017 <span class="comment">/* Contributing Programmer(s):                               */</span>
<a name="l00018"></a>00018 <span class="comment">/*                                                           */</span>
<a name="l00019"></a>00019 <span class="comment">/* Revision History:                                         */</span>
<a name="l00020"></a>00020 <span class="comment">/*      6.23: Correction for FalseSymbol/TrueSymbol. DR0859  */</span>
<a name="l00021"></a>00021 <span class="comment">/*                                                           */</span>
<a name="l00022"></a>00022 <span class="comment">/*      6.24: Removed INCREMENTAL_RESET and                  */</span>
<a name="l00023"></a>00023 <span class="comment">/*            LOGICAL_DEPENDENCIES compilation flags.        */</span>
<a name="l00024"></a>00024 <span class="comment">/*                                                           */</span>
<a name="l00025"></a>00025 <span class="comment">/*            Renamed BOOLEAN macro type to intBool.         */</span>
<a name="l00026"></a>00026 <span class="comment">/*                                                           */</span>
<a name="l00027"></a>00027 <span class="comment">/*            Rule with exists CE has incorrect activation.  */</span>
<a name="l00028"></a>00028 <span class="comment">/*            DR0867                                         */</span>
<a name="l00029"></a>00029 <span class="comment">/*                                                           */</span>
<a name="l00030"></a>00030 <span class="comment">/*      6.30: Added support for hashed alpha memories.       */</span>
<a name="l00031"></a>00031 <span class="comment">/*                                                           */</span>
<a name="l00032"></a>00032 <span class="comment">/*            Added additional developer statistics to help  */</span>
<a name="l00033"></a>00033 <span class="comment">/*            analyze join network performance.              */</span>
<a name="l00034"></a>00034 <span class="comment">/*                                                           */</span>
<a name="l00035"></a>00035 <span class="comment">/*            Removed pseudo-facts used in not CE.           */</span>
<a name="l00036"></a>00036 <span class="comment">/*                                                           */</span>
<a name="l00037"></a>00037 <span class="comment">/*************************************************************/</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="drive_8c.html#42be7f3f4b11fd4bc81145dd8c17fc30">00039</a> <span class="preprocessor">#define _DRIVE_SOURCE_</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00042"></a><a class="code" href="drive_8c.html#6e4807994d76152e81b38b27baabf806">00042</a> <span class="preprocessor">#define _STDIO_INCLUDED_</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include "<a class="code" href="setup_8h.html">setup.h</a>"</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#if DEFRULE_CONSTRUCT</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="preprocessor">#include "<a class="code" href="agenda_8h.html">agenda.h</a>"</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include "<a class="code" href="constant_8h.html">constant.h</a>"</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include "<a class="code" href="engine_8h.html">engine.h</a>"</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include "<a class="code" href="envrnmnt_8h.html">envrnmnt.h</a>"</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include "<a class="code" href="memalloc_8h.html">memalloc.h</a>"</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include "<a class="code" href="prntutil_8h.html">prntutil.h</a>"</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include "<a class="code" href="reteutil_8h.html">reteutil.h</a>"</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include "<a class="code" href="retract_8h.html">retract.h</a>"</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include "<a class="code" href="router_8h.html">router.h</a>"</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include "<a class="code" href="lgcldpnd_8h.html">lgcldpnd.h</a>"</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include "<a class="code" href="incrrset_8h.html">incrrset.h</a>"</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include "<a class="code" href="drive_8h.html">drive.h</a>"</span>  
<a name="l00062"></a>00062   
<a name="l00063"></a>00063 <span class="comment">/***************************************/</span>
<a name="l00064"></a>00064 <span class="comment">/* LOCAL INTERNAL FUNCTION DEFINITIONS */</span>
<a name="l00065"></a>00065 <span class="comment">/***************************************/</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067    <span class="keyword">static</span> <span class="keywordtype">void</span>                    EmptyDrive(<span class="keywordtype">void</span> *,<span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *,<span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *);
<a name="l00068"></a>00068    <span class="keyword">static</span> <span class="keywordtype">void</span>                    JoinNetErrorMessage(<span class="keywordtype">void</span> *,<span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *);
<a name="l00069"></a>00069    
<a name="l00070"></a>00070 <span class="comment">/************************************************/</span>
<a name="l00071"></a>00071 <span class="comment">/* NetworkAssert: Primary routine for filtering */</span>
<a name="l00072"></a>00072 <span class="comment">/*   a partial match through the join network.  */</span>
<a name="l00073"></a>00073 <span class="comment">/************************************************/</span>
<a name="l00074"></a><a class="code" href="drive_8h.html#c4673c71cb7fa5e2a608128638e9ac0a">00074</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <span class="keywordtype">void</span> <a class="code" href="drive_8c.html#0ebdc6bf3fa8574a23a444cd958c2f54">NetworkAssert</a>(
<a name="l00075"></a>00075   <span class="keywordtype">void</span> *theEnv,
<a name="l00076"></a>00076   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *binds,
<a name="l00077"></a>00077   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *join)
<a name="l00078"></a>00078   {
<a name="l00079"></a>00079    <span class="comment">/*=========================================================*/</span>
<a name="l00080"></a>00080    <span class="comment">/* If an incremental reset is being performed and the join */</span>
<a name="l00081"></a>00081    <span class="comment">/* is not part of the network to be reset, then return.    */</span>
<a name="l00082"></a>00082    <span class="comment">/*=========================================================*/</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="preprocessor">#if (! BLOAD_ONLY) &amp;&amp; (! RUN_TIME)</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;IncrementalResetInProgress &amp;&amp; (join-&gt;<a class="code" href="structjoinNode.html#384fcb0f8920144f764ef134b900ae8c">initialize</a> == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) <span class="keywordflow">return</span>;
<a name="l00086"></a>00086 <span class="preprocessor">#endif</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00088"></a>00088    <span class="comment">/*==================================================*/</span>
<a name="l00089"></a>00089    <span class="comment">/* Use a special routine if this is the first join. */</span>
<a name="l00090"></a>00090    <span class="comment">/*==================================================*/</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092    <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#da4108cb45de315861720c05033882a2">firstJoin</a>)
<a name="l00093"></a>00093      {
<a name="l00094"></a>00094       EmptyDrive(theEnv,join,binds);
<a name="l00095"></a>00095       <span class="keywordflow">return</span>;
<a name="l00096"></a>00096      }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098    <span class="comment">/*================================*/</span>
<a name="l00099"></a>00099    <span class="comment">/* Enter the join from the right. */</span>
<a name="l00100"></a>00100    <span class="comment">/*================================*/</span>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102    <a class="code" href="drive_8c.html#9f91703e1f312f04c19c9c45ffa86baf">NetworkAssertRight</a>(theEnv,binds,join);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104    <span class="keywordflow">return</span>;
<a name="l00105"></a>00105   }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="comment">/*****************************************************/</span>
<a name="l00108"></a>00108 <span class="comment">/* NetworkAssertRight: Primary routine for filtering */</span>
<a name="l00109"></a>00109 <span class="comment">/*   a partial match through the join network from   */</span>
<a name="l00110"></a>00110 <span class="comment">/*   the RHS of a join.                              */</span>
<a name="l00111"></a>00111 <span class="comment">/*****************************************************/</span>
<a name="l00112"></a><a class="code" href="drive_8h.html#9faa2d2895d20fd5345d7910c1a201b6">00112</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <span class="keywordtype">void</span> <a class="code" href="drive_8c.html#9f91703e1f312f04c19c9c45ffa86baf">NetworkAssertRight</a>(
<a name="l00113"></a>00113   <span class="keywordtype">void</span> *theEnv,
<a name="l00114"></a>00114   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *rhsBinds,
<a name="l00115"></a>00115   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *join)
<a name="l00116"></a>00116   {
<a name="l00117"></a>00117    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *lhsBinds, *nextBind;
<a name="l00118"></a>00118    <span class="keywordtype">int</span> exprResult, restore = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00119"></a>00119    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldLHSBinds = NULL;
<a name="l00120"></a>00120    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldRHSBinds = NULL;
<a name="l00121"></a>00121    <span class="keyword">struct </span><a class="code" href="structjoinNode.html">joinNode</a> *oldJoin = NULL;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123    <span class="comment">/*=========================================================*/</span>
<a name="l00124"></a>00124    <span class="comment">/* If an incremental reset is being performed and the join */</span>
<a name="l00125"></a>00125    <span class="comment">/* is not part of the network to be reset, then return.    */</span>
<a name="l00126"></a>00126    <span class="comment">/*=========================================================*/</span>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="preprocessor">#if (! BLOAD_ONLY) &amp;&amp; (! RUN_TIME)</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;IncrementalResetInProgress &amp;&amp; (join-&gt;<a class="code" href="structjoinNode.html#384fcb0f8920144f764ef134b900ae8c">initialize</a> == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) <span class="keywordflow">return</span>;
<a name="l00130"></a>00130 <span class="preprocessor">#endif</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>
<a name="l00132"></a>00132    <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#da4108cb45de315861720c05033882a2">firstJoin</a>)
<a name="l00133"></a>00133      {
<a name="l00134"></a>00134       EmptyDrive(theEnv,join,rhsBinds);
<a name="l00135"></a>00135       <span class="keywordflow">return</span>;
<a name="l00136"></a>00136      }
<a name="l00137"></a>00137   
<a name="l00138"></a>00138    <span class="comment">/*=====================================================*/</span>
<a name="l00139"></a>00139    <span class="comment">/* The partial matches entering from the LHS of a join */</span>
<a name="l00140"></a>00140    <span class="comment">/* are stored in the left beta memory of the join.     */</span>
<a name="l00141"></a>00141    <span class="comment">/*=====================================================*/</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143    lhsBinds = <a class="code" href="reteutil_8c.html#40378cb5aa439acb8e48d4692adc75a5">GetLeftBetaMemory</a>(join,rhsBinds-&gt;<a class="code" href="structpartialMatch.html#06891ed0d32bc2d70d8d6df6d3be85ab">hashValue</a>);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (lhsBinds != NULL)
<a name="l00147"></a>00147      { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;rightToLeftLoops++; }
<a name="l00148"></a>00148 <span class="preprocessor">#endif</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>
<a name="l00150"></a>00150    <span class="comment">/*====================================*/</span>
<a name="l00151"></a>00151    <span class="comment">/* Set up the evaluation environment. */</span>
<a name="l00152"></a>00152    <span class="comment">/*====================================*/</span>
<a name="l00153"></a>00153    
<a name="l00154"></a>00154    <span class="keywordflow">if</span> (lhsBinds != NULL)
<a name="l00155"></a>00155      {
<a name="l00156"></a>00156       oldLHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds;
<a name="l00157"></a>00157       oldRHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds;
<a name="l00158"></a>00158       oldJoin = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin;
<a name="l00159"></a>00159       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = rhsBinds;
<a name="l00160"></a>00160       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = join;
<a name="l00161"></a>00161       restore = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00162"></a>00162      }
<a name="l00163"></a>00163     
<a name="l00164"></a>00164    <span class="comment">/*===================================================*/</span>
<a name="l00165"></a>00165    <span class="comment">/* Compare each set of binds on the opposite side of */</span>
<a name="l00166"></a>00166    <span class="comment">/* the join with the set of binds that entered this  */</span>
<a name="l00167"></a>00167    <span class="comment">/* join. If the binds don't mismatch, then perform   */</span>
<a name="l00168"></a>00168    <span class="comment">/* the appropriate action for the logic of the join. */</span>
<a name="l00169"></a>00169    <span class="comment">/*===================================================*/</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171    <span class="keywordflow">while</span> (lhsBinds != NULL)
<a name="l00172"></a>00172      {
<a name="l00173"></a>00173       nextBind = lhsBinds-&gt;<a class="code" href="structpartialMatch.html#3d1e0cd602af59bfe5095c222c8744f5">nextInMemory</a>;
<a name="l00174"></a>00174       join-&gt;<a class="code" href="structjoinNode.html#056f97964c5c181cf26a9239b08424e6">memoryCompares</a>++;
<a name="l00175"></a>00175       
<a name="l00176"></a>00176       <span class="comment">/*===========================================================*/</span>
<a name="l00177"></a>00177       <span class="comment">/* Initialize some variables pointing to the partial matches */</span>
<a name="l00178"></a>00178       <span class="comment">/* in the LHS and RHS of the join.                           */</span>
<a name="l00179"></a>00179       <span class="comment">/*===========================================================*/</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181       <span class="keywordflow">if</span> (lhsBinds-&gt;<a class="code" href="structpartialMatch.html#06891ed0d32bc2d70d8d6df6d3be85ab">hashValue</a> != rhsBinds-&gt;<a class="code" href="structpartialMatch.html#06891ed0d32bc2d70d8d6df6d3be85ab">hashValue</a>)
<a name="l00182"></a>00182         {
<a name="l00183"></a>00183 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#e4fb1d6b67e1d74a03b9960e2de58b5b">leftMemory</a>-&gt;<a class="code" href="structbetaMemory.html#3ee136a94dbf4ca8147484b4506314eb">size</a> == 1)
<a name="l00185"></a>00185            { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;betaHashListSkips++; }
<a name="l00186"></a>00186          <span class="keywordflow">else</span>
<a name="l00187"></a>00187            { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;betaHashHTSkips++; }
<a name="l00188"></a>00188            
<a name="l00189"></a>00189          <span class="keywordflow">if</span> (lhsBinds-&gt;<a class="code" href="structpartialMatch.html#040447599a303f98dc185a649c1d26e5">marker</a> != NULL)
<a name="l00190"></a>00190            { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;unneededMarkerCompare++; }
<a name="l00191"></a>00191 <span class="preprocessor">#endif</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span>         lhsBinds = nextBind;
<a name="l00193"></a>00193          <span class="keywordflow">continue</span>;
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195         
<a name="l00196"></a>00196       <span class="comment">/*===============================================================*/</span>
<a name="l00197"></a>00197       <span class="comment">/* If there already is an associated RHS partial match stored in */</span>
<a name="l00198"></a>00198       <span class="comment">/* the LHS partial match from the beta memory of this join, then */</span>
<a name="l00199"></a>00199       <span class="comment">/* the exists/nand CE has already been satisfied and we can move */</span>
<a name="l00200"></a>00200       <span class="comment">/* on to the next partial match found in the beta memory.        */</span>
<a name="l00201"></a>00201       <span class="comment">/*===============================================================*/</span>
<a name="l00202"></a>00202         
<a name="l00203"></a>00203       <span class="keywordflow">if</span> (lhsBinds-&gt;<a class="code" href="structpartialMatch.html#040447599a303f98dc185a649c1d26e5">marker</a> != NULL)
<a name="l00204"></a>00204         { 
<a name="l00205"></a>00205 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>         <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;unneededMarkerCompare++;
<a name="l00207"></a>00207 <span class="preprocessor">#endif</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span>         lhsBinds = nextBind;
<a name="l00209"></a>00209          <span class="keywordflow">continue</span>;
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212       <span class="comment">/*===================================================*/</span>
<a name="l00213"></a>00213       <span class="comment">/* If the join has no expression associated with it, */</span>
<a name="l00214"></a>00214       <span class="comment">/* then the new partial match derived from the LHS   */</span>
<a name="l00215"></a>00215       <span class="comment">/* and RHS partial matches is valid.                 */</span>
<a name="l00216"></a>00216       <span class="comment">/*===================================================*/</span>
<a name="l00217"></a>00217 
<a name="l00218"></a>00218       <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#5a7923a59b2c3d0155d540fc82519b32">networkTest</a> == NULL)
<a name="l00219"></a>00219         { exprResult = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221       <span class="comment">/*=========================================================*/</span>
<a name="l00222"></a>00222       <span class="comment">/* If the join has an expression associated with it, then  */</span>
<a name="l00223"></a>00223       <span class="comment">/* evaluate the expression to determine if the new partial */</span>
<a name="l00224"></a>00224       <span class="comment">/* match derived from the LHS and RHS partial matches is   */</span>
<a name="l00225"></a>00225       <span class="comment">/* valid (i.e. variable bindings are consistent and        */</span>
<a name="l00226"></a>00226       <span class="comment">/* predicate expressions evaluate to TRUE).                */</span>
<a name="l00227"></a>00227       <span class="comment">/*=========================================================*/</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229       <span class="keywordflow">else</span>
<a name="l00230"></a>00230         {
<a name="l00231"></a>00231 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>         <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;rightToLeftComparisons++;
<a name="l00233"></a>00233 <span class="preprocessor">#endif</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>         <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = lhsBinds;
<a name="l00235"></a>00235          exprResult = <a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,join-&gt;<a class="code" href="structjoinNode.html#5a7923a59b2c3d0155d540fc82519b32">networkTest</a>,join);
<a name="l00236"></a>00236          <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00237"></a>00237            {
<a name="l00238"></a>00238             <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#f06236758119fb6a2611237c29704aa9">patternIsNegated</a>) exprResult = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00239"></a>00239             <a class="code" href="evaluatn_8c.html#4838a1d558eaca9eb78fe6560ff7fb0f">SetEvaluationError</a>(theEnv,<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00240"></a>00240            }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (exprResult)
<a name="l00244"></a>00244            { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;rightToLeftSucceeds++; }
<a name="l00245"></a>00245 <span class="preprocessor">#endif</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>        }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248       <span class="keywordflow">if</span> ((join-&gt;<a class="code" href="structjoinNode.html#10ac274db28ad5ad6f0011107cbfdbe2">secondaryNetworkTest</a> != NULL) &amp;&amp; exprResult)
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250          <span class="comment">/* EngineData(theEnv)-&gt;GlobalRHSBinds = NULL; */</span>
<a name="l00251"></a>00251          
<a name="l00252"></a>00252          exprResult = <a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,join-&gt;<a class="code" href="structjoinNode.html#10ac274db28ad5ad6f0011107cbfdbe2">secondaryNetworkTest</a>,join);
<a name="l00253"></a>00253          <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00254"></a>00254            { <a class="code" href="evaluatn_8c.html#4838a1d558eaca9eb78fe6560ff7fb0f">SetEvaluationError</a>(theEnv,<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); }
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257       <span class="comment">/*====================================================*/</span>
<a name="l00258"></a>00258       <span class="comment">/* If the join expression evaluated to TRUE (i.e.     */</span>
<a name="l00259"></a>00259       <span class="comment">/* there were no conflicts between variable bindings, */</span>
<a name="l00260"></a>00260       <span class="comment">/* all tests were satisfied, etc.), then perform the  */</span>
<a name="l00261"></a>00261       <span class="comment">/* appropriate action given the logic of this join.   */</span>
<a name="l00262"></a>00262       <span class="comment">/*====================================================*/</span>
<a name="l00263"></a>00263 
<a name="l00264"></a>00264       <span class="keywordflow">if</span> (exprResult != <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00265"></a>00265         {
<a name="l00266"></a>00266          <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a>)
<a name="l00267"></a>00267            {
<a name="l00268"></a>00268             <a class="code" href="reteutil_8c.html#30151c543a3af5c797210f2f85025098">AddBlockedLink</a>(lhsBinds,rhsBinds);
<a name="l00269"></a>00269             <a class="code" href="drive_8c.html#60e6c573a2e8d469952bfbcfd59d261b">PPDrive</a>(theEnv,lhsBinds,NULL,join);
<a name="l00270"></a>00270            }
<a name="l00271"></a>00271          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#f06236758119fb6a2611237c29704aa9">patternIsNegated</a> || join-&gt;<a class="code" href="structjoinNode.html#22ea635b86cce6477405601441a28102">joinFromTheRight</a>)
<a name="l00272"></a>00272            {
<a name="l00273"></a>00273             <a class="code" href="reteutil_8c.html#30151c543a3af5c797210f2f85025098">AddBlockedLink</a>(lhsBinds,rhsBinds);
<a name="l00274"></a>00274             <span class="keywordflow">if</span> (lhsBinds-&gt;<a class="code" href="structpartialMatch.html#8c56a81e1b65e9c34973d932f42b451a">children</a> != NULL)
<a name="l00275"></a>00275               { <a class="code" href="retract_8c.html#34175c41c50182b76f7da83b3b5db467">PosEntryRetractBeta</a>(theEnv,lhsBinds,lhsBinds-&gt;<a class="code" href="structpartialMatch.html#8c56a81e1b65e9c34973d932f42b451a">children</a>); }
<a name="l00276"></a>00276             <span class="comment">/*</span>
<a name="l00277"></a>00277 <span class="comment">            if (lhsBinds-&gt;dependents != NULL) </span>
<a name="l00278"></a>00278 <span class="comment">              { RemoveLogicalSupport(theEnv,lhsBinds); }</span>
<a name="l00279"></a>00279 <span class="comment">            */</span>
<a name="l00280"></a>00280            } 
<a name="l00281"></a>00281          <span class="keywordflow">else</span>
<a name="l00282"></a>00282            { <a class="code" href="drive_8c.html#60e6c573a2e8d469952bfbcfd59d261b">PPDrive</a>(theEnv,lhsBinds,rhsBinds,join); }
<a name="l00283"></a>00283         }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285       <span class="comment">/*====================================*/</span>
<a name="l00286"></a>00286       <span class="comment">/* Move on to the next partial match. */</span>
<a name="l00287"></a>00287       <span class="comment">/*====================================*/</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289       lhsBinds = nextBind;
<a name="l00290"></a>00290      }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    <span class="comment">/*=========================================*/</span>
<a name="l00293"></a>00293    <span class="comment">/* Restore the old evaluation environment. */</span>
<a name="l00294"></a>00294    <span class="comment">/*=========================================*/</span>
<a name="l00295"></a>00295 
<a name="l00296"></a>00296    <span class="keywordflow">if</span> (restore)
<a name="l00297"></a>00297      {
<a name="l00298"></a>00298       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = oldLHSBinds;
<a name="l00299"></a>00299       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = oldRHSBinds;
<a name="l00300"></a>00300       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = oldJoin;
<a name="l00301"></a>00301      }
<a name="l00302"></a>00302      
<a name="l00303"></a>00303    <span class="keywordflow">return</span>;
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">/****************************************************/</span>
<a name="l00307"></a>00307 <span class="comment">/* NetworkAssertLeft: Primary routine for filtering */</span>
<a name="l00308"></a>00308 <span class="comment">/*   a partial match through the join network when  */</span>
<a name="l00309"></a>00309 <span class="comment">/*   entering through the left side of a join.      */</span>
<a name="l00310"></a>00310 <span class="comment">/****************************************************/</span>
<a name="l00311"></a><a class="code" href="drive_8h.html#07b855a07615924151c9254c250abc1d">00311</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <span class="keywordtype">void</span> <a class="code" href="drive_8c.html#99b8d340bedf52dc92dfec9fe90bafc8">NetworkAssertLeft</a>(
<a name="l00312"></a>00312   <span class="keywordtype">void</span> *theEnv,
<a name="l00313"></a>00313   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *lhsBinds,
<a name="l00314"></a>00314   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *join)
<a name="l00315"></a>00315   {
<a name="l00316"></a>00316    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *rhsBinds;
<a name="l00317"></a>00317    <span class="keywordtype">int</span> exprResult, restore = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00318"></a>00318    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> entryHashValue;
<a name="l00319"></a>00319    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldLHSBinds = NULL;
<a name="l00320"></a>00320    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldRHSBinds = NULL;
<a name="l00321"></a>00321    <span class="keyword">struct </span><a class="code" href="structjoinNode.html">joinNode</a> *oldJoin = NULL;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323    <span class="comment">/*=========================================================*/</span>
<a name="l00324"></a>00324    <span class="comment">/* If an incremental reset is being performed and the join */</span>
<a name="l00325"></a>00325    <span class="comment">/* is not part of the network to be reset, then return.    */</span>
<a name="l00326"></a>00326    <span class="comment">/*=========================================================*/</span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="preprocessor">#if (! BLOAD_ONLY) &amp;&amp; (! RUN_TIME)</span>
<a name="l00329"></a>00329 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;IncrementalResetInProgress &amp;&amp; (join-&gt;<a class="code" href="structjoinNode.html#384fcb0f8920144f764ef134b900ae8c">initialize</a> == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) <span class="keywordflow">return</span>;
<a name="l00330"></a>00330 <span class="preprocessor">#endif</span>
<a name="l00331"></a>00331 <span class="preprocessor"></span>
<a name="l00332"></a>00332    <span class="comment">/*===================================*/</span>
<a name="l00333"></a>00333    <span class="comment">/* The only action for the last join */</span>
<a name="l00334"></a>00334    <span class="comment">/* of a rule is to activate it.      */</span>
<a name="l00335"></a>00335    <span class="comment">/*===================================*/</span>
<a name="l00336"></a>00336    
<a name="l00337"></a>00337    <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#e2525c2dc944c3871cd97b2917dd45b7">ruleToActivate</a> != NULL)
<a name="l00338"></a>00338      {
<a name="l00339"></a>00339       <a class="code" href="agenda_8c.html#c2704bae49e528ebe449a101b883af2e">AddActivation</a>(theEnv,join-&gt;<a class="code" href="structjoinNode.html#e2525c2dc944c3871cd97b2917dd45b7">ruleToActivate</a>,lhsBinds);
<a name="l00340"></a>00340       <span class="keywordflow">return</span>;
<a name="l00341"></a>00341      }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343    <span class="comment">/*==================================================*/</span>
<a name="l00344"></a>00344    <span class="comment">/* Initialize some variables used to indicate which */</span>
<a name="l00345"></a>00345    <span class="comment">/* side is being compared to the new partial match. */</span>
<a name="l00346"></a>00346    <span class="comment">/*==================================================*/</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348    entryHashValue = lhsBinds-&gt;<a class="code" href="structpartialMatch.html#06891ed0d32bc2d70d8d6df6d3be85ab">hashValue</a>;
<a name="l00349"></a>00349    <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#22ea635b86cce6477405601441a28102">joinFromTheRight</a>)
<a name="l00350"></a>00350      { rhsBinds = <a class="code" href="reteutil_8c.html#0ba1086bceef758ed27b9c0841e13dd5">GetRightBetaMemory</a>(join,entryHashValue); }
<a name="l00351"></a>00351    <span class="keywordflow">else</span>
<a name="l00352"></a>00352      { rhsBinds = <a class="code" href="reteutil_8c.html#a8aedce39044dfed7b975ed48f6b0a51">GetAlphaMemory</a>(theEnv,(<span class="keyword">struct</span> <a class="code" href="structpatternNodeHeader.html">patternNodeHeader</a> *) join-&gt;<a class="code" href="structjoinNode.html#086b0c0e039513500538a39792a7d6aa">rightSideEntryStructure</a>,entryHashValue); }
<a name="l00353"></a>00353        
<a name="l00354"></a>00354 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00355"></a>00355 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (rhsBinds != NULL)
<a name="l00356"></a>00356      { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;leftToRightLoops++; }
<a name="l00357"></a>00357 <span class="preprocessor">#endif</span>
<a name="l00358"></a>00358 <span class="preprocessor"></span>   
<a name="l00359"></a>00359    <span class="comment">/*====================================*/</span>
<a name="l00360"></a>00360    <span class="comment">/* Set up the evaluation environment. */</span>
<a name="l00361"></a>00361    <span class="comment">/*====================================*/</span>
<a name="l00362"></a>00362    
<a name="l00363"></a>00363    <span class="keywordflow">if</span> ((rhsBinds != NULL) || (join-&gt;<a class="code" href="structjoinNode.html#10ac274db28ad5ad6f0011107cbfdbe2">secondaryNetworkTest</a> != NULL))
<a name="l00364"></a>00364      {
<a name="l00365"></a>00365       oldLHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds;
<a name="l00366"></a>00366       oldRHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds;
<a name="l00367"></a>00367       oldJoin = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin;
<a name="l00368"></a>00368       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = lhsBinds;
<a name="l00369"></a>00369       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = join;
<a name="l00370"></a>00370       restore = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00371"></a>00371      }
<a name="l00372"></a>00372   
<a name="l00373"></a>00373    <span class="comment">/*===================================================*/</span>
<a name="l00374"></a>00374    <span class="comment">/* Compare each set of binds on the opposite side of */</span>
<a name="l00375"></a>00375    <span class="comment">/* the join with the set of binds that entered this  */</span>
<a name="l00376"></a>00376    <span class="comment">/* join. If the binds don't mismatch, then perform   */</span>
<a name="l00377"></a>00377    <span class="comment">/* the appropriate action for the logic of the join. */</span>
<a name="l00378"></a>00378    <span class="comment">/*===================================================*/</span>
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    <span class="keywordflow">while</span> (rhsBinds != NULL)
<a name="l00381"></a>00381      {
<a name="l00382"></a>00382       join-&gt;<a class="code" href="structjoinNode.html#056f97964c5c181cf26a9239b08424e6">memoryCompares</a>++;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384       <span class="comment">/*===================================================*/</span>
<a name="l00385"></a>00385       <span class="comment">/* If the join has no expression associated with it, */</span>
<a name="l00386"></a>00386       <span class="comment">/* then the new partial match derived from the LHS   */</span>
<a name="l00387"></a>00387       <span class="comment">/* and RHS partial matches is valid.                 */</span>
<a name="l00388"></a>00388       <span class="comment">/*===================================================*/</span>
<a name="l00389"></a>00389 
<a name="l00390"></a>00390       <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#5a7923a59b2c3d0155d540fc82519b32">networkTest</a> == NULL)
<a name="l00391"></a>00391         { exprResult = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393       <span class="comment">/*=========================================================*/</span>
<a name="l00394"></a>00394       <span class="comment">/* If the join has an expression associated with it, then  */</span>
<a name="l00395"></a>00395       <span class="comment">/* evaluate the expression to determine if the new partial */</span>
<a name="l00396"></a>00396       <span class="comment">/* match derived from the LHS and RHS partial matches is   */</span>
<a name="l00397"></a>00397       <span class="comment">/* valid (i.e. variable bindings are consistent and        */</span>
<a name="l00398"></a>00398       <span class="comment">/* predicate expressions evaluate to TRUE).                */</span>
<a name="l00399"></a>00399       <span class="comment">/*=========================================================*/</span>
<a name="l00400"></a>00400 
<a name="l00401"></a>00401       <span class="keywordflow">else</span>
<a name="l00402"></a>00402         {
<a name="l00403"></a>00403 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span>         <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;leftToRightComparisons++;
<a name="l00405"></a>00405 <span class="preprocessor">#endif</span>
<a name="l00406"></a>00406 <span class="preprocessor"></span>         <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = rhsBinds;
<a name="l00407"></a>00407          
<a name="l00408"></a>00408          exprResult = <a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,join-&gt;<a class="code" href="structjoinNode.html#5a7923a59b2c3d0155d540fc82519b32">networkTest</a>,join);
<a name="l00409"></a>00409          <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00410"></a>00410            {
<a name="l00411"></a>00411             <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#f06236758119fb6a2611237c29704aa9">patternIsNegated</a>) exprResult = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00412"></a>00412             <a class="code" href="evaluatn_8c.html#4838a1d558eaca9eb78fe6560ff7fb0f">SetEvaluationError</a>(theEnv,<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00413"></a>00413            }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00416"></a>00416 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (exprResult)
<a name="l00417"></a>00417            { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;leftToRightSucceeds++; }
<a name="l00418"></a>00418 <span class="preprocessor">#endif</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>        }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421       <span class="comment">/*====================================================*/</span>
<a name="l00422"></a>00422       <span class="comment">/* If the join expression evaluated to TRUE (i.e.     */</span>
<a name="l00423"></a>00423       <span class="comment">/* there were no conflicts between variable bindings, */</span>
<a name="l00424"></a>00424       <span class="comment">/* all tests were satisfied, etc.), then perform the  */</span>
<a name="l00425"></a>00425       <span class="comment">/* appropriate action given the logic of this join.   */</span>
<a name="l00426"></a>00426       <span class="comment">/*====================================================*/</span>
<a name="l00427"></a>00427 
<a name="l00428"></a>00428       <span class="keywordflow">if</span> (exprResult != <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00429"></a>00429         {
<a name="l00430"></a>00430          <span class="comment">/*==============================================*/</span>
<a name="l00431"></a>00431          <span class="comment">/* Use the PPDrive routine when the join isn't  */</span>
<a name="l00432"></a>00432          <span class="comment">/* associated with a not CE and it doesn't have */</span>
<a name="l00433"></a>00433          <span class="comment">/* a join from the right.                       */</span>
<a name="l00434"></a>00434          <span class="comment">/*==============================================*/</span>
<a name="l00435"></a>00435 
<a name="l00436"></a>00436          <span class="keywordflow">if</span> ((join-&gt;<a class="code" href="structjoinNode.html#f06236758119fb6a2611237c29704aa9">patternIsNegated</a> == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp;
<a name="l00437"></a>00437              (join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a> == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp;
<a name="l00438"></a>00438              (join-&gt;<a class="code" href="structjoinNode.html#22ea635b86cce6477405601441a28102">joinFromTheRight</a> == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>))
<a name="l00439"></a>00439            { <a class="code" href="drive_8c.html#60e6c573a2e8d469952bfbcfd59d261b">PPDrive</a>(theEnv,lhsBinds,rhsBinds,join); }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441          <span class="comment">/*==================================================*/</span>
<a name="l00442"></a>00442          <span class="comment">/* At most, one partial match will be generated for */</span>
<a name="l00443"></a>00443          <span class="comment">/* a match from the right memory of an exists CE.   */</span>
<a name="l00444"></a>00444          <span class="comment">/*==================================================*/</span>
<a name="l00445"></a>00445          
<a name="l00446"></a>00446          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a>)
<a name="l00447"></a>00447            { 
<a name="l00448"></a>00448             <a class="code" href="reteutil_8c.html#30151c543a3af5c797210f2f85025098">AddBlockedLink</a>(lhsBinds,rhsBinds);
<a name="l00449"></a>00449             <a class="code" href="drive_8c.html#60e6c573a2e8d469952bfbcfd59d261b">PPDrive</a>(theEnv,lhsBinds,NULL,join);
<a name="l00450"></a>00450             <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = oldLHSBinds;
<a name="l00451"></a>00451             <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = oldRHSBinds;
<a name="l00452"></a>00452             <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = oldJoin;
<a name="l00453"></a>00453             <span class="keywordflow">return</span>;
<a name="l00454"></a>00454            }
<a name="l00455"></a>00455            
<a name="l00456"></a>00456          <span class="comment">/*===========================================================*/</span>
<a name="l00457"></a>00457          <span class="comment">/* If the new partial match entered from the LHS of the join */</span>
<a name="l00458"></a>00458          <span class="comment">/* and the join is either associated with a not CE or the    */</span>
<a name="l00459"></a>00459          <span class="comment">/* join has a join from the right, then mark the LHS partial */</span>
<a name="l00460"></a>00460          <span class="comment">/* match indicating that there is a RHS partial match        */</span>
<a name="l00461"></a>00461          <span class="comment">/* preventing this join from being satisfied. Once this has  */</span>
<a name="l00462"></a>00462          <span class="comment">/* happened, the other RHS partial matches don't have to be  */</span>
<a name="l00463"></a>00463          <span class="comment">/* tested since it only takes one partial match to prevent   */</span>
<a name="l00464"></a>00464          <span class="comment">/* the LHS from being satisfied.                             */</span>
<a name="l00465"></a>00465          <span class="comment">/*===========================================================*/</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467          <span class="keywordflow">else</span>
<a name="l00468"></a>00468            {
<a name="l00469"></a>00469             <a class="code" href="reteutil_8c.html#30151c543a3af5c797210f2f85025098">AddBlockedLink</a>(lhsBinds,rhsBinds);
<a name="l00470"></a>00470             <span class="keywordflow">break</span>;
<a name="l00471"></a>00471            }
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474       <span class="comment">/*====================================*/</span>
<a name="l00475"></a>00475       <span class="comment">/* Move on to the next partial match. */</span>
<a name="l00476"></a>00476       <span class="comment">/*====================================*/</span>
<a name="l00477"></a>00477 
<a name="l00478"></a>00478       rhsBinds = rhsBinds-&gt;<a class="code" href="structpartialMatch.html#3d1e0cd602af59bfe5095c222c8744f5">nextInMemory</a>;
<a name="l00479"></a>00479      }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481    <span class="comment">/*==================================================================*/</span>
<a name="l00482"></a>00482    <span class="comment">/* If a join with an associated not CE or join from the right was   */</span>
<a name="l00483"></a>00483    <span class="comment">/* entered from the LHS side of the join, and the join expression   */</span>
<a name="l00484"></a>00484    <span class="comment">/* failed for all sets of matches for the new bindings on the LHS   */</span>
<a name="l00485"></a>00485    <span class="comment">/* side (there was no RHS partial match preventing the LHS partial  */</span>
<a name="l00486"></a>00486    <span class="comment">/* match from being satisfied), then the LHS partial match appended */</span>
<a name="l00487"></a>00487    <span class="comment">/* with an pseudo-fact that represents the instance of the not      */</span>
<a name="l00488"></a>00488    <span class="comment">/* pattern or join from the right that was satisfied should be sent */</span>
<a name="l00489"></a>00489    <span class="comment">/* to the joins below this join.                                    */</span>
<a name="l00490"></a>00490    <span class="comment">/*==================================================================*/</span>
<a name="l00491"></a>00491 
<a name="l00492"></a>00492    <span class="keywordflow">if</span> ((join-&gt;<a class="code" href="structjoinNode.html#f06236758119fb6a2611237c29704aa9">patternIsNegated</a> || join-&gt;<a class="code" href="structjoinNode.html#22ea635b86cce6477405601441a28102">joinFromTheRight</a>) &amp;&amp; 
<a name="l00493"></a>00493        (! join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a>) &amp;&amp;
<a name="l00494"></a>00494        (lhsBinds-&gt;<a class="code" href="structpartialMatch.html#040447599a303f98dc185a649c1d26e5">marker</a> == NULL))
<a name="l00495"></a>00495      {
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#10ac274db28ad5ad6f0011107cbfdbe2">secondaryNetworkTest</a> != NULL)
<a name="l00497"></a>00497         {
<a name="l00498"></a>00498          <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = NULL;
<a name="l00499"></a>00499          
<a name="l00500"></a>00500          exprResult = <a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,join-&gt;<a class="code" href="structjoinNode.html#10ac274db28ad5ad6f0011107cbfdbe2">secondaryNetworkTest</a>,join);
<a name="l00501"></a>00501          <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00502"></a>00502            { <a class="code" href="evaluatn_8c.html#4838a1d558eaca9eb78fe6560ff7fb0f">SetEvaluationError</a>(theEnv,<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); }
<a name="l00503"></a>00503            
<a name="l00504"></a>00504          <span class="keywordflow">if</span> (exprResult)
<a name="l00505"></a>00505             { <a class="code" href="drive_8c.html#60e6c573a2e8d469952bfbcfd59d261b">PPDrive</a>(theEnv,lhsBinds,NULL,join); }
<a name="l00506"></a>00506                 }
<a name="l00507"></a>00507       <span class="keywordflow">else</span>
<a name="l00508"></a>00508         { <a class="code" href="drive_8c.html#60e6c573a2e8d469952bfbcfd59d261b">PPDrive</a>(theEnv,lhsBinds,NULL,join); } 
<a name="l00509"></a>00509      }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511    <span class="comment">/*=========================================*/</span>
<a name="l00512"></a>00512    <span class="comment">/* Restore the old evaluation environment. */</span>
<a name="l00513"></a>00513    <span class="comment">/*=========================================*/</span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515    <span class="keywordflow">if</span> (restore)
<a name="l00516"></a>00516      {
<a name="l00517"></a>00517       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = oldLHSBinds;
<a name="l00518"></a>00518       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = oldRHSBinds;
<a name="l00519"></a>00519       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = oldJoin;
<a name="l00520"></a>00520      }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522    <span class="keywordflow">return</span>;
<a name="l00523"></a>00523   }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="comment">/*******************************************************/</span>
<a name="l00526"></a>00526 <span class="comment">/* EvaluateJoinExpression: Evaluates join expressions. */</span>
<a name="l00527"></a>00527 <span class="comment">/*   Performs a faster evaluation for join expressions */</span>
<a name="l00528"></a>00528 <span class="comment">/*   than if EvaluateExpression was used directly.     */</span>
<a name="l00529"></a>00529 <span class="comment">/*******************************************************/</span>
<a name="l00530"></a><a class="code" href="drive_8h.html#048b6d9fa573a68bba69714597fc32a1">00530</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <a class="code" href="setup_8h.html#efc64ca566de630647065f0393714e33">intBool</a> <a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(
<a name="l00531"></a>00531   <span class="keywordtype">void</span> *theEnv,
<a name="l00532"></a>00532   <span class="keyword">struct</span> <a class="code" href="structexpr.html">expr</a> *joinExpr,
<a name="l00533"></a>00533   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *joinPtr)
<a name="l00534"></a>00534   {
<a name="l00535"></a>00535    <a class="code" href="structdataObject.html">DATA_OBJECT</a> theResult;
<a name="l00536"></a>00536    <span class="keywordtype">int</span> andLogic, result = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538    <span class="comment">/*======================================*/</span>
<a name="l00539"></a>00539    <span class="comment">/* A NULL expression evaluates to TRUE. */</span>
<a name="l00540"></a>00540    <span class="comment">/*======================================*/</span>
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="keywordflow">if</span> (joinExpr == NULL) <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544    <span class="comment">/*====================================================*/</span>
<a name="l00545"></a>00545    <span class="comment">/* Initialize some variables which allow this routine */</span>
<a name="l00546"></a>00546    <span class="comment">/* to avoid calling the "and" and "or" functions if   */</span>
<a name="l00547"></a>00547    <span class="comment">/* they are the first part of the expression to be    */</span>
<a name="l00548"></a>00548    <span class="comment">/* evaluated. Most of the join expressions do not use */</span>
<a name="l00549"></a>00549    <span class="comment">/* deeply nested and/or functions so this technique   */</span>
<a name="l00550"></a>00550    <span class="comment">/* speeds up evaluation.                              */</span>
<a name="l00551"></a>00551    <span class="comment">/*====================================================*/</span>
<a name="l00552"></a>00552 
<a name="l00553"></a>00553    <span class="keywordflow">if</span> (joinExpr-&gt;<a class="code" href="structexpr.html#6eb6cb57ccd3d563bc16e83e4535feab">value</a> == <a class="code" href="expressn_8h.html#7248435eddb51e9e425a4e2619fc2c34">ExpressionData</a>(theEnv)-&gt;PTR_AND)
<a name="l00554"></a>00554      {
<a name="l00555"></a>00555       andLogic = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00556"></a>00556       joinExpr = joinExpr-&gt;<a class="code" href="structexpr.html#ac2175a99d114b58ef1bffc6e203c000">argList</a>;
<a name="l00557"></a>00557      }
<a name="l00558"></a>00558    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (joinExpr-&gt;<a class="code" href="structexpr.html#6eb6cb57ccd3d563bc16e83e4535feab">value</a> == <a class="code" href="expressn_8h.html#7248435eddb51e9e425a4e2619fc2c34">ExpressionData</a>(theEnv)-&gt;PTR_OR)
<a name="l00559"></a>00559      {
<a name="l00560"></a>00560       andLogic = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00561"></a>00561       joinExpr = joinExpr-&gt;<a class="code" href="structexpr.html#ac2175a99d114b58ef1bffc6e203c000">argList</a>;
<a name="l00562"></a>00562      }
<a name="l00563"></a>00563    <span class="keywordflow">else</span>
<a name="l00564"></a>00564      { andLogic = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566    <span class="comment">/*=========================================*/</span>
<a name="l00567"></a>00567    <span class="comment">/* Evaluate each of the expressions linked */</span>
<a name="l00568"></a>00568    <span class="comment">/* together in the join expression.        */</span>
<a name="l00569"></a>00569    <span class="comment">/*=========================================*/</span>
<a name="l00570"></a>00570 
<a name="l00571"></a>00571    <span class="keywordflow">while</span> (joinExpr != NULL)
<a name="l00572"></a>00572      {
<a name="l00573"></a>00573       <span class="comment">/*================================*/</span>
<a name="l00574"></a>00574       <span class="comment">/* Evaluate a primitive function. */</span>
<a name="l00575"></a>00575       <span class="comment">/*================================*/</span>
<a name="l00576"></a>00576 
<a name="l00577"></a>00577       <span class="keywordflow">if</span> ((<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;PrimitivesArray[joinExpr-&gt;<a class="code" href="structexpr.html#14679e5a41ead5a41829fccddea69d77">type</a>] == NULL) ?
<a name="l00578"></a>00578           <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a> :
<a name="l00579"></a>00579           <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;PrimitivesArray[joinExpr-&gt;<a class="code" href="structexpr.html#14679e5a41ead5a41829fccddea69d77">type</a>]-&gt;evaluateFunction != NULL)
<a name="l00580"></a>00580         {
<a name="l00581"></a>00581          <span class="keyword">struct </span><a class="code" href="structexpr.html">expr</a> *oldArgument;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583          oldArgument = <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;CurrentExpression;
<a name="l00584"></a>00584          <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;CurrentExpression = joinExpr;
<a name="l00585"></a>00585          result = (*<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;PrimitivesArray[joinExpr-&gt;<a class="code" href="structexpr.html#14679e5a41ead5a41829fccddea69d77">type</a>]-&gt;evaluateFunction)(theEnv,joinExpr-&gt;<a class="code" href="structexpr.html#6eb6cb57ccd3d563bc16e83e4535feab">value</a>,&amp;theResult);
<a name="l00586"></a>00586          <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;CurrentExpression = oldArgument;
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589       <span class="comment">/*=============================*/</span>
<a name="l00590"></a>00590       <span class="comment">/* Evaluate the "or" function. */</span>
<a name="l00591"></a>00591       <span class="comment">/*=============================*/</span>
<a name="l00592"></a>00592 
<a name="l00593"></a>00593       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (joinExpr-&gt;<a class="code" href="structexpr.html#6eb6cb57ccd3d563bc16e83e4535feab">value</a> == <a class="code" href="expressn_8h.html#7248435eddb51e9e425a4e2619fc2c34">ExpressionData</a>(theEnv)-&gt;PTR_OR)
<a name="l00594"></a>00594         {
<a name="l00595"></a>00595          result = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00596"></a>00596          <span class="keywordflow">if</span> (<a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,joinExpr,joinPtr) == <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l00597"></a>00597            {
<a name="l00598"></a>00598             <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00599"></a>00599               { <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); }
<a name="l00600"></a>00600             result = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00601"></a>00601            }
<a name="l00602"></a>00602          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00603"></a>00603            { <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); }
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606       <span class="comment">/*==============================*/</span>
<a name="l00607"></a>00607       <span class="comment">/* Evaluate the "and" function. */</span>
<a name="l00608"></a>00608       <span class="comment">/*==============================*/</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (joinExpr-&gt;<a class="code" href="structexpr.html#6eb6cb57ccd3d563bc16e83e4535feab">value</a> == <a class="code" href="expressn_8h.html#7248435eddb51e9e425a4e2619fc2c34">ExpressionData</a>(theEnv)-&gt;PTR_AND)
<a name="l00611"></a>00611         {
<a name="l00612"></a>00612          result = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00613"></a>00613          <span class="keywordflow">if</span> (<a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,joinExpr,joinPtr) == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00614"></a>00614            {
<a name="l00615"></a>00615             <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00616"></a>00616               { <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); }
<a name="l00617"></a>00617             result = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00618"></a>00618            }
<a name="l00619"></a>00619          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00620"></a>00620            { <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); }
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       <span class="comment">/*==========================================================*/</span>
<a name="l00624"></a>00624       <span class="comment">/* Evaluate all other expressions using EvaluateExpression. */</span>
<a name="l00625"></a>00625       <span class="comment">/*==========================================================*/</span>
<a name="l00626"></a>00626 
<a name="l00627"></a>00627       <span class="keywordflow">else</span>
<a name="l00628"></a>00628         {
<a name="l00629"></a>00629          <a class="code" href="evaluatn_8c.html#ebbee0425a8f547d2d5ed617aad7bf31">EvaluateExpression</a>(theEnv,joinExpr,&amp;theResult);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631          <span class="keywordflow">if</span> (<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError)
<a name="l00632"></a>00632            {
<a name="l00633"></a>00633             JoinNetErrorMessage(theEnv,joinPtr);
<a name="l00634"></a>00634             <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00635"></a>00635            }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637          <span class="keywordflow">if</span> ((theResult.<a class="code" href="structdataObject.html#954e353f458ca7ef5156fd007876a661">value</a> == <a class="code" href="symbol_8h.html#28bc5f2453724b2390332c860128bd23">EnvFalseSymbol</a>(theEnv)) &amp;&amp; (theResult.<a class="code" href="structdataObject.html#8fce8fcf0a4e230b3c928ffd1bff6444">type</a> == <a class="code" href="constant_8h.html#5f9ae9ce6aa6f82108b260135b2e63a0">SYMBOL</a>))
<a name="l00638"></a>00638            { result = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>; }
<a name="l00639"></a>00639          <span class="keywordflow">else</span>
<a name="l00640"></a>00640            { result = <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; }
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643       <span class="comment">/*====================================*/</span>
<a name="l00644"></a>00644       <span class="comment">/* Handle the short cut evaluation of */</span>
<a name="l00645"></a>00645       <span class="comment">/* the "and" and "or" functions.      */</span>
<a name="l00646"></a>00646       <span class="comment">/*====================================*/</span>
<a name="l00647"></a>00647 
<a name="l00648"></a>00648       <span class="keywordflow">if</span> ((andLogic == <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) &amp;&amp; (result == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>))
<a name="l00649"></a>00649         { <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); }
<a name="l00650"></a>00650       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((andLogic == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp; (result == <a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))
<a name="l00651"></a>00651         { <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>); }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653       <span class="comment">/*==============================================*/</span>
<a name="l00654"></a>00654       <span class="comment">/* Move to the next expression to be evaluated. */</span>
<a name="l00655"></a>00655       <span class="comment">/*==============================================*/</span>
<a name="l00656"></a>00656 
<a name="l00657"></a>00657       joinExpr = joinExpr-&gt;<a class="code" href="structexpr.html#4a7a256a1abe65578afebd185bf2c064">nextArg</a>;
<a name="l00658"></a>00658      }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660    <span class="comment">/*=================================================*/</span>
<a name="l00661"></a>00661    <span class="comment">/* Return the result of evaluating the expression. */</span>
<a name="l00662"></a>00662    <span class="comment">/*=================================================*/</span>
<a name="l00663"></a>00663 
<a name="l00664"></a>00664    <span class="keywordflow">return</span>(result);
<a name="l00665"></a>00665   }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 <span class="comment">/*******************************************************/</span>
<a name="l00668"></a>00668 <span class="comment">/* EvaluateSecondaryNetworkTest:     */</span>
<a name="l00669"></a>00669 <span class="comment">/*******************************************************/</span>
<a name="l00670"></a><a class="code" href="drive_8h.html#8e9148e44e34a3efed8522ba12fe9bd9">00670</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <a class="code" href="setup_8h.html#efc64ca566de630647065f0393714e33">intBool</a> <a class="code" href="drive_8c.html#1bc3b16afc163f9e48d276ddf8789dd7">EvaluateSecondaryNetworkTest</a>(
<a name="l00671"></a>00671   <span class="keywordtype">void</span> *theEnv,
<a name="l00672"></a>00672   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *leftMatch,
<a name="l00673"></a>00673   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *joinPtr)
<a name="l00674"></a>00674   {
<a name="l00675"></a>00675    <span class="keywordtype">int</span> joinExpr;
<a name="l00676"></a>00676    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldLHSBinds;
<a name="l00677"></a>00677    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldRHSBinds;
<a name="l00678"></a>00678    <span class="keyword">struct </span><a class="code" href="structjoinNode.html">joinNode</a> *oldJoin;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680    <span class="keywordflow">if</span> (joinPtr-&gt;<a class="code" href="structjoinNode.html#10ac274db28ad5ad6f0011107cbfdbe2">secondaryNetworkTest</a> == NULL)
<a name="l00681"></a>00681      { <span class="keywordflow">return</span>(<a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>); }
<a name="l00682"></a>00682         
<a name="l00683"></a>00683 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00684"></a>00684 <span class="preprocessor"></span>   <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;rightToLeftComparisons++;
<a name="l00685"></a>00685 <span class="preprocessor">#endif</span>
<a name="l00686"></a>00686 <span class="preprocessor"></span>   oldLHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds;
<a name="l00687"></a>00687    oldRHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds;
<a name="l00688"></a>00688    oldJoin = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin;
<a name="l00689"></a>00689    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = leftMatch;
<a name="l00690"></a>00690    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = NULL;
<a name="l00691"></a>00691    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = joinPtr;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693    joinExpr = <a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,joinPtr-&gt;<a class="code" href="structjoinNode.html#10ac274db28ad5ad6f0011107cbfdbe2">secondaryNetworkTest</a>,joinPtr);
<a name="l00694"></a>00694    <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = oldLHSBinds;
<a name="l00697"></a>00697    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = oldRHSBinds;
<a name="l00698"></a>00698    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = oldJoin;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700    <span class="keywordflow">return</span>(joinExpr);
<a name="l00701"></a>00701   }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="comment">/*******************************************************/</span>
<a name="l00704"></a>00704 <span class="comment">/* BetaMemoryHashValue:     */</span>
<a name="l00705"></a>00705 <span class="comment">/*******************************************************/</span>
<a name="l00706"></a><a class="code" href="drive_8h.html#07dfd89c8684f73466a691418c02d73f">00706</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="drive_8c.html#b3f6f2f3dfad644927ccf985e937fe29">BetaMemoryHashValue</a>(
<a name="l00707"></a>00707   <span class="keywordtype">void</span> *theEnv,
<a name="l00708"></a>00708   <span class="keyword">struct</span> <a class="code" href="structexpr.html">expr</a> *hashExpr,
<a name="l00709"></a>00709   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *lbinds,
<a name="l00710"></a>00710   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *rbinds,
<a name="l00711"></a>00711   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *joinPtr)
<a name="l00712"></a>00712   {
<a name="l00713"></a>00713    <a class="code" href="structdataObject.html">DATA_OBJECT</a> theResult;
<a name="l00714"></a>00714    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldLHSBinds;
<a name="l00715"></a>00715    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldRHSBinds;
<a name="l00716"></a>00716    <span class="keyword">struct </span><a class="code" href="structjoinNode.html">joinNode</a> *oldJoin;
<a name="l00717"></a>00717    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hashValue = 0;
<a name="l00718"></a>00718    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> multiplier = 1;
<a name="l00719"></a>00719    
<a name="l00720"></a>00720    <span class="comment">/*======================================*/</span>
<a name="l00721"></a>00721    <span class="comment">/* A NULL expression evaluates to zero. */</span>
<a name="l00722"></a>00722    <span class="comment">/*======================================*/</span>
<a name="l00723"></a>00723 
<a name="l00724"></a>00724    <span class="keywordflow">if</span> (hashExpr == NULL) <span class="keywordflow">return</span>(0);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    <span class="comment">/*=========================================*/</span>
<a name="l00727"></a>00727    <span class="comment">/* Initialize some of the global variables */</span>
<a name="l00728"></a>00728    <span class="comment">/* used when evaluating expressions.       */</span>
<a name="l00729"></a>00729    <span class="comment">/*=========================================*/</span>
<a name="l00730"></a>00730 
<a name="l00731"></a>00731    oldLHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds;
<a name="l00732"></a>00732    oldRHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds;
<a name="l00733"></a>00733    oldJoin = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin;
<a name="l00734"></a>00734    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = lbinds;
<a name="l00735"></a>00735    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = rbinds;
<a name="l00736"></a>00736    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = joinPtr;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738    <span class="comment">/*=========================================*/</span>
<a name="l00739"></a>00739    <span class="comment">/* Evaluate each of the expressions linked */</span>
<a name="l00740"></a>00740    <span class="comment">/* together in the join expression.        */</span>
<a name="l00741"></a>00741    <span class="comment">/*=========================================*/</span>
<a name="l00742"></a>00742 
<a name="l00743"></a>00743    <span class="keywordflow">while</span> (hashExpr != NULL)
<a name="l00744"></a>00744      {
<a name="l00745"></a>00745       <span class="comment">/*================================*/</span>
<a name="l00746"></a>00746       <span class="comment">/* Evaluate a primitive function. */</span>
<a name="l00747"></a>00747       <span class="comment">/*================================*/</span>
<a name="l00748"></a>00748 
<a name="l00749"></a>00749       <span class="keywordflow">if</span> ((<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;PrimitivesArray[hashExpr-&gt;<a class="code" href="structexpr.html#14679e5a41ead5a41829fccddea69d77">type</a>] == NULL) ?
<a name="l00750"></a>00750           <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a> :
<a name="l00751"></a>00751           <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;PrimitivesArray[hashExpr-&gt;<a class="code" href="structexpr.html#14679e5a41ead5a41829fccddea69d77">type</a>]-&gt;evaluateFunction != NULL)
<a name="l00752"></a>00752         {
<a name="l00753"></a>00753          <span class="keyword">struct </span><a class="code" href="structexpr.html">expr</a> *oldArgument;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755          oldArgument = <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;CurrentExpression;
<a name="l00756"></a>00756          <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;CurrentExpression = hashExpr;
<a name="l00757"></a>00757          (*<a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;PrimitivesArray[hashExpr-&gt;<a class="code" href="structexpr.html#14679e5a41ead5a41829fccddea69d77">type</a>]-&gt;evaluateFunction)(theEnv,hashExpr-&gt;<a class="code" href="structexpr.html#6eb6cb57ccd3d563bc16e83e4535feab">value</a>,&amp;theResult);
<a name="l00758"></a>00758          <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;CurrentExpression = oldArgument;
<a name="l00759"></a>00759         }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       <span class="comment">/*==========================================================*/</span>
<a name="l00762"></a>00762       <span class="comment">/* Evaluate all other expressions using EvaluateExpression. */</span>
<a name="l00763"></a>00763       <span class="comment">/*==========================================================*/</span>
<a name="l00764"></a>00764 
<a name="l00765"></a>00765       <span class="keywordflow">else</span>
<a name="l00766"></a>00766         { <a class="code" href="evaluatn_8c.html#ebbee0425a8f547d2d5ed617aad7bf31">EvaluateExpression</a>(theEnv,hashExpr,&amp;theResult); }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768       <span class="keywordflow">switch</span> (theResult.<a class="code" href="structdataObject.html#8fce8fcf0a4e230b3c928ffd1bff6444">type</a>)
<a name="l00769"></a>00769         {
<a name="l00770"></a>00770          <span class="keywordflow">case</span> <a class="code" href="constant_8h.html#0f4d394a3ab4e09bff60f714c66dc5ee">STRING</a>:
<a name="l00771"></a>00771          <span class="keywordflow">case</span> <a class="code" href="constant_8h.html#5f9ae9ce6aa6f82108b260135b2e63a0">SYMBOL</a>:
<a name="l00772"></a>00772          <span class="keywordflow">case</span> <a class="code" href="constant_8h.html#80a09ddad7f09decf54205d2e18a4520">INSTANCE_NAME</a>:
<a name="l00773"></a>00773            hashValue += (((<a class="code" href="structsymbolHashNode.html">SYMBOL_HN</a> *) theResult.<a class="code" href="structdataObject.html#954e353f458ca7ef5156fd007876a661">value</a>)-&gt;bucket * multiplier);
<a name="l00774"></a>00774            <span class="keywordflow">break</span>;
<a name="l00775"></a>00775              
<a name="l00776"></a>00776          <span class="keywordflow">case</span> <a class="code" href="constant_8h.html#91d43eadec33c80149f92e5abf5df58c">INTEGER</a>:
<a name="l00777"></a>00777             hashValue += (((<a class="code" href="structintegerHashNode.html">INTEGER_HN</a> *) theResult.<a class="code" href="structdataObject.html#954e353f458ca7ef5156fd007876a661">value</a>)-&gt;bucket * multiplier);
<a name="l00778"></a>00778             <span class="keywordflow">break</span>;
<a name="l00779"></a>00779              
<a name="l00780"></a>00780          <span class="keywordflow">case</span> <a class="code" href="constant_8h.html#e8690abbffa85934d64d545920e2b108">FLOAT</a>:
<a name="l00781"></a>00781            hashValue += (((<a class="code" href="structfloatHashNode.html">FLOAT_HN</a> *) theResult.<a class="code" href="structdataObject.html#954e353f458ca7ef5156fd007876a661">value</a>)-&gt;bucket * multiplier);
<a name="l00782"></a>00782            <span class="keywordflow">break</span>;
<a name="l00783"></a>00783         }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785       <span class="comment">/*==============================================*/</span>
<a name="l00786"></a>00786       <span class="comment">/* Move to the next expression to be evaluated. */</span>
<a name="l00787"></a>00787       <span class="comment">/*==============================================*/</span>
<a name="l00788"></a>00788 
<a name="l00789"></a>00789       hashExpr = hashExpr-&gt;<a class="code" href="structexpr.html#4a7a256a1abe65578afebd185bf2c064">nextArg</a>;
<a name="l00790"></a>00790           multiplier = multiplier * 509;
<a name="l00791"></a>00791          }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793    <span class="comment">/*=======================================*/</span>
<a name="l00794"></a>00794    <span class="comment">/* Restore some of the global variables. */</span>
<a name="l00795"></a>00795    <span class="comment">/*=======================================*/</span>
<a name="l00796"></a>00796 
<a name="l00797"></a>00797    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = oldLHSBinds;
<a name="l00798"></a>00798    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = oldRHSBinds;
<a name="l00799"></a>00799    <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = oldJoin;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801    <span class="comment">/*=================================================*/</span>
<a name="l00802"></a>00802    <span class="comment">/* Return the result of evaluating the expression. */</span>
<a name="l00803"></a>00803    <span class="comment">/*=================================================*/</span>
<a name="l00804"></a>00804 
<a name="l00805"></a>00805    <span class="keywordflow">return</span>(hashValue);
<a name="l00806"></a>00806   }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 <span class="comment">/*******************************************************************/</span>
<a name="l00809"></a>00809 <span class="comment">/* PPDrive: Handles the merging of an alpha memory partial match   */</span>
<a name="l00810"></a>00810 <span class="comment">/*   with a beta memory partial match for a join that has positive */</span>
<a name="l00811"></a>00811 <span class="comment">/*   LHS entry and positive RHS entry. The partial matches being   */</span>
<a name="l00812"></a>00812 <span class="comment">/*   merged have previously been checked to determine that they    */</span>
<a name="l00813"></a>00813 <span class="comment">/*   satisify the constraints for the join. Once merged, the new   */</span>
<a name="l00814"></a>00814 <span class="comment">/*   partial match is sent to each child join of the join from     */</span>
<a name="l00815"></a>00815 <span class="comment">/*   which the merge took place.                                   */</span>
<a name="l00816"></a>00816 <span class="comment">/*******************************************************************/</span>
<a name="l00817"></a><a class="code" href="drive_8h.html#b80b376b8a7b9510887eba00c12eb0eb">00817</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <span class="keywordtype">void</span> <a class="code" href="drive_8c.html#60e6c573a2e8d469952bfbcfd59d261b">PPDrive</a>(
<a name="l00818"></a>00818   <span class="keywordtype">void</span> *theEnv,
<a name="l00819"></a>00819   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *lhsBinds,
<a name="l00820"></a>00820   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *rhsBinds,
<a name="l00821"></a>00821   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *join)
<a name="l00822"></a>00822   {
<a name="l00823"></a>00823    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *linker;
<a name="l00824"></a>00824    <span class="keyword">struct </span><a class="code" href="structjoinLink.html">joinLink</a> *listOfJoins;
<a name="l00825"></a>00825    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hashValue;
<a name="l00826"></a>00826    
<a name="l00827"></a>00827    <span class="comment">/*================================================*/</span>
<a name="l00828"></a>00828    <span class="comment">/* Send the new partial match to all child joins. */</span>
<a name="l00829"></a>00829    <span class="comment">/*================================================*/</span>
<a name="l00830"></a>00830 
<a name="l00831"></a>00831    listOfJoins = join-&gt;<a class="code" href="structjoinNode.html#2df14c8c95ff43d8a528f2cb543b3945">nextLinks</a>;
<a name="l00832"></a>00832    <span class="keywordflow">if</span> (listOfJoins == NULL) <span class="keywordflow">return</span>;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834    <span class="comment">/*===============================================================*/</span>
<a name="l00835"></a>00835    <span class="comment">/* In the current implementation, all children of this join must */</span>
<a name="l00836"></a>00836    <span class="comment">/* be entered from the same side (either all left or all right). */</span>
<a name="l00837"></a>00837    <span class="comment">/*===============================================================*/</span>
<a name="l00838"></a>00838    
<a name="l00839"></a>00839    <span class="keywordflow">while</span> (listOfJoins != NULL)
<a name="l00840"></a>00840      {
<a name="l00841"></a>00841       <span class="comment">/*==================================================*/</span>
<a name="l00842"></a>00842       <span class="comment">/* Merge the alpha and beta memory partial matches. */</span>
<a name="l00843"></a>00843       <span class="comment">/*==================================================*/</span>
<a name="l00844"></a>00844 
<a name="l00845"></a>00845       linker = <a class="code" href="reteutil_8c.html#d538dd9db8d9e0cd35b3dc181d585dbe">MergePartialMatches</a>(theEnv,lhsBinds,rhsBinds);
<a name="l00846"></a>00846 
<a name="l00847"></a>00847       <span class="comment">/*================================================*/</span>
<a name="l00848"></a>00848       <span class="comment">/* Determine the hash value of the partial match. */</span>
<a name="l00849"></a>00849       <span class="comment">/*================================================*/</span>
<a name="l00850"></a>00850 
<a name="l00851"></a>00851       <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a> == <a class="code" href="constant_8h.html#4e965587deb6c2c052a6894f950028aa">LHS</a>)
<a name="l00852"></a>00852         {
<a name="l00853"></a>00853          <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#cf55a8a14506d2e26110796456526315">leftHash</a> != NULL)
<a name="l00854"></a>00854            { hashValue = <a class="code" href="drive_8c.html#b3f6f2f3dfad644927ccf985e937fe29">BetaMemoryHashValue</a>(theEnv,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#cf55a8a14506d2e26110796456526315">leftHash</a>,linker,NULL,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l00855"></a>00855          <span class="keywordflow">else</span>
<a name="l00856"></a>00856            { hashValue = 0; }
<a name="l00857"></a>00857         }
<a name="l00858"></a>00858       <span class="keywordflow">else</span>
<a name="l00859"></a>00859         { 
<a name="l00860"></a>00860          <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#f9a75100bba0026259eca32d2cf1fd0f">rightHash</a> != NULL)
<a name="l00861"></a>00861            { hashValue = <a class="code" href="drive_8c.html#b3f6f2f3dfad644927ccf985e937fe29">BetaMemoryHashValue</a>(theEnv,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#f9a75100bba0026259eca32d2cf1fd0f">rightHash</a>,linker,NULL,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l00862"></a>00862          <span class="keywordflow">else</span>
<a name="l00863"></a>00863            { hashValue = 0; }
<a name="l00864"></a>00864         }
<a name="l00865"></a>00865      
<a name="l00866"></a>00866       <span class="comment">/*=======================================================*/</span>
<a name="l00867"></a>00867       <span class="comment">/* Add the partial match to the beta memory of the join. */</span>
<a name="l00868"></a>00868       <span class="comment">/*=======================================================*/</span>
<a name="l00869"></a>00869 
<a name="l00870"></a>00870       <a class="code" href="reteutil_8c.html#30992942276de8e17662cced374c52db">UpdateBetaPMLinks</a>(theEnv,linker,lhsBinds,rhsBinds,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>,hashValue,listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a>);
<a name="l00871"></a>00871       
<a name="l00872"></a>00872       <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a> == <a class="code" href="constant_8h.html#4e965587deb6c2c052a6894f950028aa">LHS</a>)
<a name="l00873"></a>00873         { <a class="code" href="drive_8c.html#99b8d340bedf52dc92dfec9fe90bafc8">NetworkAssertLeft</a>(theEnv,linker,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l00874"></a>00874       <span class="keywordflow">else</span>
<a name="l00875"></a>00875         { <a class="code" href="drive_8c.html#9f91703e1f312f04c19c9c45ffa86baf">NetworkAssertRight</a>(theEnv,linker,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l00876"></a>00876       
<a name="l00877"></a>00877       listOfJoins = listOfJoins-&gt;<a class="code" href="structjoinLink.html#65205828523dfea6b7bbc27e7ffac3b7">next</a>;
<a name="l00878"></a>00878      }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880    <span class="keywordflow">return</span>;
<a name="l00881"></a>00881   }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 <span class="comment">/***********************************************************************/</span>
<a name="l00884"></a>00884 <span class="comment">/* EPMDrive: Drives an empty partial match to the next level of joins. */</span>
<a name="l00885"></a>00885 <span class="comment">/*   An empty partial match is usually associated with a negated CE    */</span>
<a name="l00886"></a>00886 <span class="comment">/*   that is the first CE of a rule.                                   */</span>
<a name="l00887"></a>00887 <span class="comment">/***********************************************************************/</span>
<a name="l00888"></a><a class="code" href="drive_8h.html#80948ca9863eafcd9aa60af5a1879a87">00888</a> <a class="code" href="setup_8h.html#62417931fe8ecc3bd4d0051db7687573">globle</a> <span class="keywordtype">void</span> <a class="code" href="drive_8c.html#b01015a5286161a7bf298f13a39d4762">EPMDrive</a>(
<a name="l00889"></a>00889   <span class="keywordtype">void</span> *theEnv,
<a name="l00890"></a>00890   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *parent,
<a name="l00891"></a>00891   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>)
<a name="l00892"></a>00892   {
<a name="l00893"></a>00893    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *linker;
<a name="l00894"></a>00894    <span class="keyword">struct </span><a class="code" href="structjoinLink.html">joinLink</a> *listOfJoins;
<a name="l00895"></a>00895    
<a name="l00896"></a>00896    listOfJoins = join-&gt;<a class="code" href="structjoinNode.html#2df14c8c95ff43d8a528f2cb543b3945">nextLinks</a>;
<a name="l00897"></a>00897    <span class="keywordflow">if</span> (listOfJoins == NULL) <span class="keywordflow">return</span>;
<a name="l00898"></a>00898          
<a name="l00899"></a>00899    <span class="keywordflow">while</span> (listOfJoins != NULL)
<a name="l00900"></a>00900      {
<a name="l00901"></a>00901       linker = <a class="code" href="reteutil_8c.html#daadef7c560241a117ee30df111705b8">CreateEmptyPartialMatch</a>(theEnv);
<a name="l00902"></a>00902          
<a name="l00903"></a>00903       <a class="code" href="reteutil_8c.html#30992942276de8e17662cced374c52db">UpdateBetaPMLinks</a>(theEnv,linker,parent,NULL,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>,0,listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a>); 
<a name="l00904"></a>00904 
<a name="l00905"></a>00905       <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a> == <a class="code" href="constant_8h.html#4e965587deb6c2c052a6894f950028aa">LHS</a>)
<a name="l00906"></a>00906         { <a class="code" href="drive_8c.html#99b8d340bedf52dc92dfec9fe90bafc8">NetworkAssertLeft</a>(theEnv,linker,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l00907"></a>00907       <span class="keywordflow">else</span>
<a name="l00908"></a>00908         { <a class="code" href="drive_8c.html#9f91703e1f312f04c19c9c45ffa86baf">NetworkAssertRight</a>(theEnv,linker,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l00909"></a>00909         
<a name="l00910"></a>00910       listOfJoins = listOfJoins-&gt;<a class="code" href="structjoinLink.html#65205828523dfea6b7bbc27e7ffac3b7">next</a>;
<a name="l00911"></a>00911      }
<a name="l00912"></a>00912   }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 <span class="comment">/***************************************************************/</span>
<a name="l00915"></a>00915 <span class="comment">/* EmptyDrive: Handles the entry of a alpha memory partial     */</span>
<a name="l00916"></a>00916 <span class="comment">/*   match from the RHS of a join that is the first join of    */</span>
<a name="l00917"></a>00917 <span class="comment">/*   a rule (i.e. a join that cannot be entered from the LHS). */</span>
<a name="l00918"></a>00918 <span class="comment">/***************************************************************/</span>
<a name="l00919"></a>00919 <span class="keyword">static</span> <span class="keywordtype">void</span> EmptyDrive(
<a name="l00920"></a>00920   <span class="keywordtype">void</span> *theEnv,
<a name="l00921"></a>00921   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>,
<a name="l00922"></a>00922   <span class="keyword">struct</span> <a class="code" href="structpartialMatch.html">partialMatch</a> *rhsBinds)
<a name="l00923"></a>00923   {
<a name="l00924"></a>00924    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *linker, *existsParent = NULL, *notParent;
<a name="l00925"></a>00925    <span class="keyword">struct </span><a class="code" href="structjoinLink.html">joinLink</a> *listOfJoins;
<a name="l00926"></a>00926    <span class="keywordtype">int</span> joinExpr;
<a name="l00927"></a>00927    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hashValue;
<a name="l00928"></a>00928    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldLHSBinds;
<a name="l00929"></a>00929    <span class="keyword">struct </span><a class="code" href="structpartialMatch.html">partialMatch</a> *oldRHSBinds;
<a name="l00930"></a>00930    <span class="keyword">struct </span><a class="code" href="structjoinNode.html">joinNode</a> *oldJoin;
<a name="l00931"></a>00931    
<a name="l00932"></a>00932    <span class="comment">/*======================================================*/</span>
<a name="l00933"></a>00933    <span class="comment">/* Determine if the alpha memory partial match satifies */</span>
<a name="l00934"></a>00934    <span class="comment">/* the join expression. If it doesn't then no further   */</span>
<a name="l00935"></a>00935    <span class="comment">/* action is taken.                                     */</span>
<a name="l00936"></a>00936    <span class="comment">/*======================================================*/</span>
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    join-&gt;<a class="code" href="structjoinNode.html#056f97964c5c181cf26a9239b08424e6">memoryCompares</a>++;
<a name="l00939"></a>00939 
<a name="l00940"></a>00940    <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#5a7923a59b2c3d0155d540fc82519b32">networkTest</a> != NULL)
<a name="l00941"></a>00941      {
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 <span class="preprocessor">#if DEVELOPER</span>
<a name="l00944"></a>00944 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#5a7923a59b2c3d0155d540fc82519b32">networkTest</a>)
<a name="l00945"></a>00945         { <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;rightToLeftComparisons++; }
<a name="l00946"></a>00946 <span class="preprocessor">#endif</span>
<a name="l00947"></a>00947 <span class="preprocessor"></span>      oldLHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds;
<a name="l00948"></a>00948       oldRHSBinds = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds;
<a name="l00949"></a>00949       oldJoin = <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin;
<a name="l00950"></a>00950       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = NULL;
<a name="l00951"></a>00951       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = rhsBinds;
<a name="l00952"></a>00952       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = join;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954       joinExpr = <a class="code" href="drive_8c.html#0781cbf13ae421824b1069f1693d8d9e">EvaluateJoinExpression</a>(theEnv,join-&gt;<a class="code" href="structjoinNode.html#5a7923a59b2c3d0155d540fc82519b32">networkTest</a>,join);
<a name="l00955"></a>00955       <a class="code" href="evaluatn_8h.html#6a6b54b36e8c0b9ea3d405270617b48c">EvaluationData</a>(theEnv)-&gt;EvaluationError = <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalLHSBinds = oldLHSBinds;
<a name="l00958"></a>00958       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalRHSBinds = oldRHSBinds;
<a name="l00959"></a>00959       <a class="code" href="engine_8h.html#7525ca3c6641b4e8a0097b27c41ffd50">EngineData</a>(theEnv)-&gt;GlobalJoin = oldJoin;
<a name="l00960"></a>00960 
<a name="l00961"></a>00961       <span class="keywordflow">if</span> (joinExpr == <a class="code" href="xclips_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>) <span class="keywordflow">return</span>;
<a name="l00962"></a>00962      }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964    <span class="comment">/*========================================================*/</span>
<a name="l00965"></a>00965    <span class="comment">/* Handle a negated first pattern or join from the right. */</span>
<a name="l00966"></a>00966    <span class="comment">/*========================================================*/</span>
<a name="l00967"></a>00967 
<a name="l00968"></a>00968    <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#f06236758119fb6a2611237c29704aa9">patternIsNegated</a> || (join-&gt;<a class="code" href="structjoinNode.html#22ea635b86cce6477405601441a28102">joinFromTheRight</a> &amp;&amp; (! join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a>))) <span class="comment">/* reorder to remove patternIsExists test */</span>
<a name="l00969"></a>00969      {
<a name="l00970"></a>00970       notParent = join-&gt;<a class="code" href="structjoinNode.html#e4fb1d6b67e1d74a03b9960e2de58b5b">leftMemory</a>-&gt;<a class="code" href="structbetaMemory.html#5ddefac8cf71ba7b04b55d7854b6f115">beta</a>[0];
<a name="l00971"></a>00971       <span class="keywordflow">if</span> (notParent-&gt;marker != NULL)
<a name="l00972"></a>00972         { <span class="keywordflow">return</span>; }
<a name="l00973"></a>00973         
<a name="l00974"></a>00974       <a class="code" href="reteutil_8c.html#30151c543a3af5c797210f2f85025098">AddBlockedLink</a>(notParent,rhsBinds);
<a name="l00975"></a>00975       
<a name="l00976"></a>00976       <span class="keywordflow">if</span> (notParent-&gt;children != NULL)
<a name="l00977"></a>00977         { <a class="code" href="retract_8c.html#34175c41c50182b76f7da83b3b5db467">PosEntryRetractBeta</a>(theEnv,notParent,notParent-&gt;children); }
<a name="l00978"></a>00978       <span class="comment">/*</span>
<a name="l00979"></a>00979 <span class="comment">      if (notParent-&gt;dependents != NULL) </span>
<a name="l00980"></a>00980 <span class="comment">                { RemoveLogicalSupport(theEnv,notParent); } </span>
<a name="l00981"></a>00981 <span class="comment">        */</span>
<a name="l00982"></a>00982               
<a name="l00983"></a>00983       <span class="keywordflow">return</span>;
<a name="l00984"></a>00984      }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986    <span class="comment">/*=====================================================*/</span>
<a name="l00987"></a>00987    <span class="comment">/* For exists CEs used as the first pattern of a rule, */</span>
<a name="l00988"></a>00988    <span class="comment">/* a special partial match in the left memory of the   */</span>
<a name="l00989"></a>00989    <span class="comment">/* join is used to track the RHS partial match         */</span>
<a name="l00990"></a>00990    <span class="comment">/* satisfying the CE.                                  */</span>
<a name="l00991"></a>00991    <span class="comment">/*=====================================================*/</span>
<a name="l00992"></a>00992   <span class="comment">/* TBD reorder */</span>
<a name="l00993"></a>00993    <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a>)
<a name="l00994"></a>00994      {
<a name="l00995"></a>00995       existsParent = join-&gt;<a class="code" href="structjoinNode.html#e4fb1d6b67e1d74a03b9960e2de58b5b">leftMemory</a>-&gt;<a class="code" href="structbetaMemory.html#5ddefac8cf71ba7b04b55d7854b6f115">beta</a>[0];
<a name="l00996"></a>00996       <span class="keywordflow">if</span> (existsParent-&gt;<a class="code" href="structpartialMatch.html#040447599a303f98dc185a649c1d26e5">marker</a> != NULL)
<a name="l00997"></a>00997         { <span class="keywordflow">return</span>; }
<a name="l00998"></a>00998       <a class="code" href="reteutil_8c.html#30151c543a3af5c797210f2f85025098">AddBlockedLink</a>(existsParent,rhsBinds);
<a name="l00999"></a>00999      }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001    <span class="comment">/*============================================*/</span>
<a name="l01002"></a>01002    <span class="comment">/* Send the partial match to all child joins. */</span>
<a name="l01003"></a>01003    <span class="comment">/*============================================*/</span>
<a name="l01004"></a>01004 
<a name="l01005"></a>01005    listOfJoins = join-&gt;<a class="code" href="structjoinNode.html#2df14c8c95ff43d8a528f2cb543b3945">nextLinks</a>;
<a name="l01006"></a>01006    <span class="keywordflow">if</span> (listOfJoins == NULL) <span class="keywordflow">return</span>;
<a name="l01007"></a>01007  
<a name="l01008"></a>01008    <span class="keywordflow">while</span> (listOfJoins != NULL)
<a name="l01009"></a>01009      {
<a name="l01010"></a>01010       <span class="comment">/*===================================================================*/</span>
<a name="l01011"></a>01011       <span class="comment">/* An exists CE as the first pattern of a rule can generate at most  */</span>
<a name="l01012"></a>01012       <span class="comment">/* one partial match, so if there's already a partial match in the   */</span>
<a name="l01013"></a>01013       <span class="comment">/* beta memory nothing further needs to be done. Since there are no  */</span>
<a name="l01014"></a>01014       <span class="comment">/* variable bindings which child joins can use for indexing, the     */</span>
<a name="l01015"></a>01015       <span class="comment">/* partial matches will always be stored in the bucket with index 0. */</span>
<a name="l01016"></a>01016       <span class="comment">/* Although an exists is associated with a specific fact/instance    */</span>
<a name="l01017"></a>01017       <span class="comment">/* (through its rightParent link) that allows it to be satisfied,    */</span>
<a name="l01018"></a>01018       <span class="comment">/* the bindings in the partial match will be empty for this CE.      */</span>
<a name="l01019"></a>01019       <span class="comment">/*===================================================================*/</span>
<a name="l01020"></a>01020 
<a name="l01021"></a>01021       <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a>)
<a name="l01022"></a>01022         { linker = <a class="code" href="reteutil_8c.html#daadef7c560241a117ee30df111705b8">CreateEmptyPartialMatch</a>(theEnv); }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024       <span class="comment">/*=============================================================*/</span>
<a name="l01025"></a>01025       <span class="comment">/* Othewise just copy the partial match from the alpha memory. */</span>
<a name="l01026"></a>01026       <span class="comment">/*=============================================================*/</span>
<a name="l01027"></a>01027 
<a name="l01028"></a>01028       <span class="keywordflow">else</span>
<a name="l01029"></a>01029         { linker = <a class="code" href="reteutil_8c.html#b7d059c47b2dd69c8ef71ab783aae089">CopyPartialMatch</a>(theEnv,rhsBinds); }
<a name="l01030"></a>01030      
<a name="l01031"></a>01031       <span class="comment">/*================================================*/</span>
<a name="l01032"></a>01032       <span class="comment">/* Determine the hash value of the partial match. */</span>
<a name="l01033"></a>01033       <span class="comment">/*================================================*/</span>
<a name="l01034"></a>01034 
<a name="l01035"></a>01035       <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a> == <a class="code" href="constant_8h.html#4e965587deb6c2c052a6894f950028aa">LHS</a>)
<a name="l01036"></a>01036         {
<a name="l01037"></a>01037          <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#cf55a8a14506d2e26110796456526315">leftHash</a> != NULL)
<a name="l01038"></a>01038            { hashValue = <a class="code" href="drive_8c.html#b3f6f2f3dfad644927ccf985e937fe29">BetaMemoryHashValue</a>(theEnv,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#cf55a8a14506d2e26110796456526315">leftHash</a>,linker,NULL,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l01039"></a>01039          <span class="keywordflow">else</span>
<a name="l01040"></a>01040            { hashValue = 0; }
<a name="l01041"></a>01041         }
<a name="l01042"></a>01042       <span class="keywordflow">else</span>
<a name="l01043"></a>01043         { 
<a name="l01044"></a>01044          <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#f9a75100bba0026259eca32d2cf1fd0f">rightHash</a> != NULL)
<a name="l01045"></a>01045            { hashValue = <a class="code" href="drive_8c.html#b3f6f2f3dfad644927ccf985e937fe29">BetaMemoryHashValue</a>(theEnv,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>-&gt;<a class="code" href="structjoinNode.html#f9a75100bba0026259eca32d2cf1fd0f">rightHash</a>,linker,NULL,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l01046"></a>01046          <span class="keywordflow">else</span>
<a name="l01047"></a>01047            { hashValue = 0; }
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049      
<a name="l01050"></a>01050       <span class="comment">/*=======================================================*/</span>
<a name="l01051"></a>01051       <span class="comment">/* Add the partial match to the beta memory of the join. */</span>
<a name="l01052"></a>01052       <span class="comment">/*=======================================================*/</span>
<a name="l01053"></a>01053 
<a name="l01054"></a>01054       <span class="keywordflow">if</span> (join-&gt;<a class="code" href="structjoinNode.html#8b449b5af34df158ff2714a5efb5a2fa">patternIsExists</a>)
<a name="l01055"></a>01055         { <a class="code" href="reteutil_8c.html#30992942276de8e17662cced374c52db">UpdateBetaPMLinks</a>(theEnv,linker,existsParent,NULL,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>,hashValue,listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a>); }
<a name="l01056"></a>01056       <span class="keywordflow">else</span>
<a name="l01057"></a>01057         { <a class="code" href="reteutil_8c.html#30992942276de8e17662cced374c52db">UpdateBetaPMLinks</a>(theEnv,linker,NULL,rhsBinds,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>,hashValue,listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a>); }
<a name="l01058"></a>01058 
<a name="l01059"></a>01059       <span class="keywordflow">if</span> (listOfJoins-&gt;<a class="code" href="structjoinLink.html#2418e179b356e4f702103fb84f33d49b">enterDirection</a> == <a class="code" href="constant_8h.html#4e965587deb6c2c052a6894f950028aa">LHS</a>)
<a name="l01060"></a>01060         { <a class="code" href="drive_8c.html#99b8d340bedf52dc92dfec9fe90bafc8">NetworkAssertLeft</a>(theEnv,linker,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l01061"></a>01061       <span class="keywordflow">else</span>
<a name="l01062"></a>01062         { <a class="code" href="drive_8c.html#9f91703e1f312f04c19c9c45ffa86baf">NetworkAssertRight</a>(theEnv,linker,listOfJoins-&gt;<a class="code" href="structjoinLink.html#b77ae67307c4d30ccc8fac55ccef7696">join</a>); }
<a name="l01063"></a>01063         
<a name="l01064"></a>01064       listOfJoins = listOfJoins-&gt;<a class="code" href="structjoinLink.html#65205828523dfea6b7bbc27e7ffac3b7">next</a>;
<a name="l01065"></a>01065      }
<a name="l01066"></a>01066   }
<a name="l01067"></a>01067   
<a name="l01068"></a>01068 <span class="comment">/********************************************************************/</span>
<a name="l01069"></a>01069 <span class="comment">/* JoinNetErrorMessage: Prints an informational message indicating  */</span>
<a name="l01070"></a>01070 <span class="comment">/*   which join of a rule generated an error when a join expression */</span>
<a name="l01071"></a>01071 <span class="comment">/*   was being evaluated.                                           */</span>
<a name="l01072"></a>01072 <span class="comment">/********************************************************************/</span>
<a name="l01073"></a>01073 <span class="keyword">static</span> <span class="keywordtype">void</span> JoinNetErrorMessage(
<a name="l01074"></a>01074   <span class="keywordtype">void</span> *theEnv,
<a name="l01075"></a>01075   <span class="keyword">struct</span> <a class="code" href="structjoinNode.html">joinNode</a> *joinPtr)
<a name="l01076"></a>01076   {
<a name="l01077"></a>01077    <a class="code" href="prntutil_8c.html#fbf692a39a683a2f1bd16185a376ae4e">PrintErrorID</a>(theEnv,<span class="stringliteral">"DRIVE"</span>,1,<a class="code" href="xclips_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01078"></a>01078    <a class="code" href="router_8c.html#b440fbdc73d01def2c24bc96adbf4aeb">EnvPrintRouter</a>(theEnv,<a class="code" href="router_8h.html#bdc841279c3796079bf651d161b136cc">WERROR</a>,<span class="stringliteral">"This error occurred in the join network\n"</span>);
<a name="l01079"></a>01079 
<a name="l01080"></a>01080    <a class="code" href="router_8c.html#b440fbdc73d01def2c24bc96adbf4aeb">EnvPrintRouter</a>(theEnv,<a class="code" href="router_8h.html#bdc841279c3796079bf651d161b136cc">WERROR</a>,<span class="stringliteral">"   Problem resides in associated join\n"</span>); <span class="comment">/* TBD generate test case for join with JFTR */</span>
<a name="l01081"></a>01081 <span class="comment">/*</span>
<a name="l01082"></a>01082 <span class="comment">   sprintf(buffer,"   Problem resides in join #%d in rule(s):\n",joinPtr-&gt;depth);</span>
<a name="l01083"></a>01083 <span class="comment">   EnvPrintRouter(theEnv,WERROR,buffer);</span>
<a name="l01084"></a>01084 <span class="comment">*/</span>
<a name="l01085"></a>01085    <a class="code" href="reteutil_8c.html#96baa9690f18ce569eaa00d259fc58fe">TraceErrorToRule</a>(theEnv,joinPtr,<span class="stringliteral">"      "</span>);
<a name="l01086"></a>01086    <a class="code" href="router_8c.html#b440fbdc73d01def2c24bc96adbf4aeb">EnvPrintRouter</a>(theEnv,<a class="code" href="router_8h.html#bdc841279c3796079bf651d161b136cc">WERROR</a>,<span class="stringliteral">"\n"</span>);
<a name="l01087"></a>01087   }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089 <span class="preprocessor">#endif </span><span class="comment">/* DEFRULE_CONSTRUCT */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jan 10 23:49:13 2011 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
